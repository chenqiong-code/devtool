# devtool network panel -耐心点、事情会变的简单

## 背景思考
我类比网站为一个人，我们利用浏览器访问网站时，其实就是认识一个人，最重要的是这个你想认识的人，其实是它想让你认识的那一副面孔，只有server哪里才存在着这个人的完全真实面目、你可以认为server才是那个真正的人，浏览器端是我们在生活中认识不同人的时候他们给我们的面孔，这里说的server统称为存放网站资源的地方，包含cdn，代理服务器等。不知道这样的类比、能不能让大家带入。而network就是在我们认识这个人的时候，这个人的实体以及他与我们的沟通，实体你可以认为这个人见到对于不同人表现的穿着打扮，发型等，而与我们的沟通方式则是与不同人的说话语气以及内容。这样我们了解了network其实就是网站针对不同用户的资源以及接口信息。那我们能从中了解到什么呢？再回到类比的场景中，我们可以获得对于这个人的第一印象，我们知道了这个人的穿着打扮的协调性、这个人的说话表达的语气等，判断出这个人的外在特征与说话方式的关系。那么我们会通过network来了解资源之间的相互关系，了解这个网站与特定用户的信息交换的目的性，判断它的资源与信息交换的关系。
下面就让我们试着利用network调试贴吧的首页看一下具体的情况。

## network panel
调试贴吧的首页、让我们从上面的背景思考结合network现有的功能去实际操作。
### 资源实体的了解
![image](https://user-images.githubusercontent.com/62834754/132018276-880ed28a-004b-4f1c-9b5d-8f17f9bed610.png)
我习惯性的打开network setting中的use large request rows、show overivew、capture screenshots。
![image](https://user-images.githubusercontent.com/62834754/132020712-1a34fdc6-bcd1-428f-9a53-524df7f37e16.png)
👆这张图片展示了我们在下载资源的时候通常在等待请求资源的时间比较多、在贴吧首页我们看到几乎所有的请求的实际下载Content Download的时间及其短暂、在Time列展示的时间里、上面是这个请求从调度发起到收到响应结束的时间、而下面展示的是上面的时间减去Content Download的时间。这并不是贴吧的服务器太慢、几乎所有的网站都是如此、这就是网络战胜距离所要付出的代价。这也提醒我们要尽量少发请求、为什么要把多个请求合并到一个中的原因也因此显而易见，就像下面贴吧首页所做的那样。
![image](https://user-images.githubusercontent.com/62834754/132021970-1493865a-8828-4baa-825c-2a9ac7ee2cce.png)
我看到它总共发起了113个请求、这种情况不知是多还是少、对比reddit（被称为国外的贴吧）的200多个请求、我不能说贴吧首页就是好的、因为Reddit已经集成了web应用的很多最新功能、在这方面贴吧落后太多。

下面就是依次介绍下面这张图片中大家主要会用到的列展示(只讨论可能会引起争议的)

![image](https://user-images.githubusercontent.com/62834754/132024391-54e11307-57b9-403f-9194-c31aaef7e2f6.png)
- type 在Google开发者工具文档中表示的是接受资源的MIME类型、这里可能在判断的时候是结合request Accept与response中的content-type两者相结合进行判断的。
- initiator 表示这条请求发起的经过的路径，如果这条请求是经过js文件发起的，它还会显示在js文件中的调用栈，这里面的东西对于进一步调试是至关重要的，我们可以找到一些事情发生的缘由、而不仅仅是获得资源
- size 上面显示的是在网络中传输包的大小、下面的显示获得http response的大小。
- Set cookies 显示了该请求设置了cookie的数量
- Cookie 该请求携带的cookie数量
- Protocol 协议名 现在的网络情况多为http 1.1 
- schema 显示url中协议部分的名称https/http
- connection id 显示http链接的标识、你可以查看是否一个链接被多次复用，如果协议列显示 h2，则浏览器可以为多个并发请求重用相同的连接
- remote adress 显示的是远程服务器的ip地址、当你使用代理的时候显示的就是本地的地址以及代理的端口
- priority 优先级显示了当浏览器在处理不同的请求资源时、对于各种资源的优先调度的排序
- waterfall 显示了各个请求从调度排队开始到发出请求获得响应的过程。

### 通过network了解网站的过程与方法

在show overivew中可以了解网站请求整个发起的过程、如果你进行仔细的分析还会发现、html解析的过程在遇到js等请求时会先下载并执行、然后在通过执行js的过程引起其他下载过程。
如果你不想通过动态的选择overivew的某一区间慢慢的去发现请求的过程、你可以通过设置网络来让整个过程变慢、这样观察起来比较清楚。
![image](https://user-images.githubusercontent.com/62834754/132079594-a2ce11db-5bda-451b-8fe7-4b2ab6b86dd6.png)

你还可以通过更多的网络设置、来改变使用的浏览器代理、你可以使用UC、opera等浏览器、还可以通过自定义代理来发起请求。
![image](https://user-images.githubusercontent.com/62834754/132079668-e9a9e379-c296-4389-bb06-a67f59116015.png)

有时我们想要了解在页面逐渐展现的过程中、请求的变化、其实两者也不是特别的有关联、但是能够让我们在一些比较特殊的场景中快速定位到请求。当我们打开capture screenshots（记得需要在空白窗口、并且dock side不能设置为新的窗口），这样我们就可以记录下页面展示的幻灯片。点击某一个截屏、会在waterfall中有一条垂直的线来定位是某刻的请求、有时候这会是有用的。

如果我们了解某一个请求被阻塞之后的页面变化、我们可以选择右击该请求、选择block request XXX来阻塞该请求。相反的对于借口请求、你可以选择relay xhr来重新发送请求接口。

如果devtool中的功能不足以让你分析该网站、你可以通过到处HAR文件的方式、该文件是http存档格式，包含了该网站所有的请求，你可以把它导入一个更专业的分析工具中、或者遇到问题时分享给别人、让他来帮你解决。

还有就是搜索功能、network面板提供了针对请求的有关正则表达式或者特定规则的过滤器以及文本搜索（这个可以让你匹配到响应内容中文本）

### 发起一个最初始的请求

怎么确保我们发出的请求是经过最完整的流程呢、没有各种各样的缓存？
一个请求可需要经过下面的几个步骤:
1.DNS查询
2.创建TCP链接
3.创建SSL链接
4.发起http请求
通过下面几种方式、可以完整发起：（当你在电脑上有其他重要活动时、请不要执行下面的操作、我就是把这个文档又重写了一遍。。给搞丢了）
1.清除电脑的DNS缓存
mac命令行执行 sudo killall -HUP mDNSResponder
2.清除浏览器的DNS缓存  chrome://net-internals/#dns
3.清除浏览器存在的链接 chrome://net-internals/#sockets
4.就是清空你自己浏览器的缓存了


